<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv='Content-type' content='text/html; charset=utf-8'>
    <title>Movie Exploration</title>
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/transition.css" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  </head>
  <body>
    <h1>Movies!</h1>
    <div id="place-holder">
      <input type="text" id="name" hint="Movie Name" />
      <button id="submit">Search</button>
      <div id="search-results"></div>
      <div id="container">
	<p>
          If you can see this, React is not working right.
          If you checked out the source from GitHub make sure to run <code>grunt</code>.
	</p>
      </div>
    </div>
    <script src="js/es5-shim.min.js"></script>
    <script src="js/es5-sham.min.js"></script>
    <script src="js/console-polyfill.js"></script>
    <script src="js/react-with-addons.js"></script>
    <script src="js/JSXTransformer.js"></script>
    <script type="text/jsx">
      var CSSTransitionGroup = React.addons.CSSTransitionGroup;
      var INTERVAL = 2000;

      var AnimateDemo = React.createClass({
        getInitialState: function() {
          return {};
        },

        /*componentDidMount: function() {
          this.interval = setInterval(this.tick, INTERVAL);
        },

        componentWillUnmount: function() {
          clearInterval(this.interval);
        },

        tick: function() {
          this.setState({start: this.state.start + 1});
        },*/

        render: function() {
          result = [<ul>];
          this.state.forEach(function(_, movie){
	    result.push(<li>{movie.Title} - {movie.Year}</li>);
	  });
	  result.push(</ul>);
          /*var children = [];
          var pos = 0;
          var colors = ['red', 'gray', 'blue'];
          for (var i = this.state.start; i < this.state.start + 3; i++) {
            var style = {
              left: pos * 128,
              background: colors[i % 3]
            };
            pos++;
            children.push(<div key={i} className="animateItem" style={style}>{i}</div>);
          }*/
          return (
            <CSSTransitionGroup
              className="animateExample"
              transitionName="example">
              {result}
            </CSSTransitionGroup>
          );
        }
      });

      React.render(
        <AnimateDemo />,
        document.getElementById('container')
      );
    </script>
    <script>
      // These should really be member functions
      format_html = function(descr) {
        result = "<ul>";
	descr.foreach(function(movie) {
	  result = result + "<li>" + movie.title + "</li>";
	});
	return result + "</ul>";
      }

      query = function(name) {
        $.ajax({
          url: "http://omdbapi.com",
          data: {t: name,
                 tomatoes: true},
          type: "GET",
          dataType: "json",

          success: function(json) {
            var movies = json["Search"];
            if(movies) {
              var description = [];
              movies.foreach(function(movie) {
                description.push({title: movie["Title"],
                                  year: movie["Year"],
                                 });
              });
              $("#search-results").html(format_html(description));
            }
            else {
              $("#search-results").text("");
            }
          }
        });
      }

      $(document).ready(function() {
        $("#submit").click(onClick=function() {
          name = $("#name").val();
          if( name.length != 0) {
              query(name);
          }
        })
      });
    </script>
  </body>
</html>
